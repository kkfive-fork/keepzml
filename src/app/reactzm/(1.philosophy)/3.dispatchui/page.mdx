import CodeTabs from 'components/codehike/code-tabs'
import Demo01 from './demo01/preview'

交互是前端开发无法避免的研究课题。通过《JavaScript 核心进阶》的学习我们知道，一个网页的运行是由多个线程共同协作完成。

当页面通过渲染线程首次渲染完成之后，页面并非永远一成不变。不同的线程活动，都需要页面 UI 给予相应的逻辑反馈。

而**数据驱动视图**是现代流行框架的一种主流开发思维，它能够帮助我们将 UI 组件的变化，抽象为数据的变化。从而极大的简化开发流程。

### *1*、传统开发方式

例如，当我们点击按钮，页面出现一个新的弹窗，弹窗上通常会有关闭按钮，点击该按钮，弹窗关闭。这是最常见的交互之一。

点击行为通过 I/O 线程告知页面，假如弹窗组件的标签已经提前写在了 HTML 中，使用 `display: none` 隐藏，传统方式下，要实现这样的效果，页面逻辑大概会有如下步骤

+ 获取弹窗组件的对象
+ 在该对象上添加弹窗显示的 className

```js
var dialog = document.getElementById('dialog')
dialog.className = 'show'
```

传统方式下，当交互逐渐变得复杂，我们需要获取大量的元素对象，然后通过对应的 api 去操作他们。这会让项目变得越来越难以维护。因此，在 React 中，我们要学会在交互过程中**提炼出来一个状态/数据**，然后通过控制这个状态的方式，来改变 UI 组件。

### 一、提炼数据

在上一章 List 组件的封装过程中，我们已经提炼出了数据，也就是 `data` 属性。那么在弹窗的显示或者隐藏这个案例中，我们需要提炼出什么数据呢？

弹窗的显示、或者隐藏，其实就是两个状态。因此，我们需要设计一个 `boolean` 类型的值，来控制弹窗的显示与隐藏。

React 内部组件提供了一个专门的 API 来创建状态，**用于存放能够驱动视图的数据**

```ts
// 默认值为 false， 弹窗隐藏
const [show, setShow] = useState(false)
```

也就是说，如果你提炼出来的数据，并不需要驱动视图的变化，就不需要使用 `useState` 来定义。


### 二、数据驱动 UI


接下来，我们期望的结果是，当我们将状态 `show` 的值，改变为 true 时，弹窗显示，当我们改变数据 `show = false` 时，弹窗隐藏。

因此，这个逻辑我们可以封装如下即可：

<Demo01 />

<CodeTabs>
```tsx !!tabs index.tsx -c
!from ./demo01/index.tsx
```

```tsx !!tabs dialog.tsx -c
!from ./demo01/dialog.tsx
```
</CodeTabs>

我们将数据 `show` 通过 React 的语法 `useState` 存放在 `state` 中，这个状态的变化会驱动视图发生变化。因此，当我们使用 `setShow(true)` 和 `setShow(false)`  改变 show 的值时，弹窗组件能够相应反馈显示和隐藏。


结合上文中我们提到的对属性 props 的处理，自定义组件 `Dialog` 的逻辑可以很好实现，请在演示案例中查看相关的代码。


show 的变化，对应控制容 div className 的变化让弹窗显示或者隐藏。关闭按钮 onClick 执行的回调函数由传入的属性 onClose 来决定。结合上例我们知道，onClose 的逻辑是 `setShow(false)`，因此，点击该按钮时，`show` 改变为 `false`，弹窗隐藏。

这是一个完整的利用数据驱动UI 的开发思维来实现的案例。

数据驱动视图的开发思维下，我们就不再去思考如何获得 DOM 元素的引用来完成对应的逻辑，而是学会将 UI 行为抽象成为数据，并通过改变数据的方式完成交互需求。我们只需要把最多的精力放在数据如何发生变化即可。通常情况下，通过 http 线程请求服务端数据，通过 I/O 线程监听用户输入信息，通过定时器线程执行对应的逻辑等方式都会导致数据发生变化，这也是我们后续学习，需要关注的重点。

这里需要注意的是，使用 state 存放的数据有自身的特性，那就是能够驱动对应的 UI 发生变化，我们在开发中，还会用到许多跟 UI 变化没有关系的数据，这个时候，就建议不要使用 state 来存放。总之，state 数据尽量与 UI 一一对应。

而掌握「数据驱动 UI 」 的核心哲学，需要反过来解读。也就是说，什么时候我们需要从 UI 中抽离数据出来。

那就是：会在交互中变化的 UI，需要抽离出数据，并用 state 存放。

例如列表组件，初始化是列表为空，请求一次接口之后，列表有了数据，那么列表的内容是变化，抽离出来的数据就是一个数组

```tsx
function App() { 
  const [list, setList] = useState([])

  return (
    <List data={list} renderItem={(item) => <Item ={item} />} />
  )
}
```

大家可以专门做一做这一方面的训练，去更多的思考一下不同组件的交互提炼出来的数据应该长什么样。例如单选，多选，tab 切换等等，也可以在群里互相交流。