import CodeTabs from 'components/codehike/code-tabs'
import Demo01 from './demo01/preview'
import Demo02 from './demo02/preview'

### 一、组件化

组件化是前端独有的开发思维，是在模块化基础之上发展而来的更高效的开发方式，是实现**所见即所得**的优秀技术方案。

我们把页面上任何一个能够独立出来的部分称之为组件，组件的最小单位，是单个 HTML 元素。

> 事实上，DOM 元素也是组件化的范畴

例如一个完整的页面，我们可以称之为页面组件。通常一个项目能够拆分出来多个页面。

```tsx App.tsx
<App>
  <HomePage />
  <AbountPage />
  <ProfilePage />
  <LoginPage />
  ...
</App>
```

一个页面能够简单拆分为头部、内容、底部，这三部分也可以被看做是三个组件。

```tsx page.tsx
<root>
  <Header />
  <Content />
  <Footer />
</root>
```

一个头部组件的拆分要视情况而定，例如本网站，头部组件可以简单拆分为 Logo、导航、个人信息，这三个部分也可以称之为组件。

```tsx Header.tsx
<header>
  <Logo />
  <Navigation />
  <Profile />
</header>
```


因此在前端开发中，组件化是一种**先拆分，后合并**的思维方式。我们能够利用这种思维，将一个项目的大问题，一层层拆分为单个组件的小问题。这是嵌套思维的运用。

HTML 标签其实是组件化思维的最早实践。例如，我们只需要在页面中，写入下面这段简单的代码，就能够在页面中渲染出一个按钮。只不过由于默认样式比较丑而极少单独运用于实践中。

```html
<!--一个没有写任何样式的按钮-->
<button>按钮</button>
```

可惜在 HTML 中，我们并没有任何一种方式能够如此轻松的得到一个自定义样式的组件。在最早的实现中，前端开发无法单独为按钮提供自定义样式，而必须与其他 CSS 代码写在一起。因此优秀的程序员会将组件化思路分别运用于 HTML 标签与 CSS 样式的编写，但这不是真正的组件化。

我们知道，一个按钮，通常由如下几部分共同组成

+ DOM 结构 `<button class="btn">按钮</button>`
+ 按钮样式 `.btn {}`
+ 按钮逻辑 `click` 等回调事件
+ 可能包括按钮前置图片
+ 可能包括背景图片
+ 可能包括一些音频资源
...

这些资源共同构成了一个完整的按钮。

<Demo01 />

最理想的方式，是把按钮当成一个独立的个体引入一次，即可完整呈现。

```ts 
// 在别的组件中引入
import Button from './components/Button'
```

但是在普通的开发结构中，我们做不到这样的便利。我们必须分别处理 HTML 标签、JavaScript 逻辑、CSS 样式，漏掉一个，就无法呈现完整的按钮。

得益于 webpack 的横空出世，组件化思维终于有了落地实现的技术基础。**webpack 能够将任何资源文件处理成为 JavaScript 能够识别的模块，参与到 JavaScript 的逻辑中去**。

> 当然，我们现在使用的 vite 也能做到


例如，当我们要实现一个按钮组件时，我们可以这样去编写 JavaScript 逻辑

<Demo02 />

<CodeTabs>
```tsx !!tabs index.tsx
!from ./demo02/index.tsx
```

```tsx !!tabs index.css
!from ./demo02/index.css
```
</CodeTabs>


这段代码比较诡异的地方在于，我们将图标资源与 CSS 文件当成了模块引入，并且还能够参与 JS 表达式的运算中去。webpack/vite 能够帮助我们识别这样的语法，它让按钮的所有组成部分聚合在一起成为了一个整体。当我们在别的地方使用时，就只需要引入按钮组件即可。

在现有的客户端解决方案中，**HTML 标签是组件化最理想的代码表达方式**。因此，在 React 中，我们依然使用标签的形式去表达一个组件。

例如，一个项目，由多个页面组件组成，我们可以这样表达

> 通常，自定义组件，首字母大写

```html
<div className="root">
  <Page1 />
  <Page2 />
  <Page3 />
</div>
```

一个页面，由头部、内容、底部组成

```html
<div className="page1_container">
  <Header />
  <Content />
  <Footer />
</div>
```

一个头部组件，由 Logo 与 搜索框组成

```html
<header>
  <img src={logo} alt="logo"/>
  <Search />
</header>
```

需要注意的是，在代码实现中，组件化主要体现在聚合上，我们会先编写一个个单独的组件，然后在更大的组件中将他们聚合在一起。但是，**正确解决问题的思路是先思考拆分**。我们需要先有一个大局观，首先着眼于整体页面，然后思考如何拆分并得到更小的组件。

### 二、**组件化在文件结构上给我们的指引**

这一部分知识非常关键。特别是对于有一定开发经验的朋友来说，它可能会彻底颠覆你的认知，并大幅度提高你的开发效率。

组件化的思维体现在组成部分的聚合。因此在文件结构上，组件化思维与后端项目常规 MVC 等分层思维差异很大，它的另一层意思，其实表达的是：凡是属于我的部分，都应该跟我放在一起。

在分层思维的长期影响下，大多数团队在前端项目中，组织代码结构的方式沿用了分层思维。

例如，我们的项目有 100 个页面，我们先不细分到组件，那么每个页面基本上都具备以下内容

+ View 视图部分，用于 UI 的展示
+ 数据访问，各种接口请求
+ 状态管理、逻辑处理，model 或者别的名称，用于处理当前页面的状态与数据
+ css，该页面自己的样式

在做项目组织的时候，我们一般都会如下这样处理

首先创建一个 pages 目录，将所有页面 UI 或者组件放到该文件夹中

> \+ 号表示文件夹，- 号表示文件

```js
+ pages
  - Home
  - Profile
  - Detail
  - Show
  ...
```

然后创建一个 apis 目录，将所有的接口请求代码放在该目录中

```js
+ apis
  - common.ts
  - home.ts
  - profile.ts
  - detail.ts
  - show.ts
  ...
```

再然后创建一个 models 目录，将所有的状态管理逻辑处理等模块放在该目录中

```bash
+ models
  - home.ts
  - profile.ts
  - detail.ts
  - show.ts
```

最后创建一个 styles 目录，将所有的 css 文件放在该目录

```bash
+ styles
  - common.css
  - home.css
  - profile.css
  - detail.css
  - show.css
  ...
```

于是，我们整个项目的代码层面，可能就会长这样

```bash
// 其他文件结构与脚手架有关，这里不做扩展
+ src
  + assets
  + commonets
  + pages
  + models
  + apis
  + styles
```

这是传统分层代码结构组织形式。那么它运用到前端，有什么问题呢？

在开发时，其实有一个痛点很多人都有，只是没有明确提出来。那就是当我们仅仅只是实现一个页面功能时，我们需要使用编辑器同时打开大量的代码文件，可能是 4、5 个，多一点的 10 多个都有。

> 因此前端的编辑器大多数都支持分屏功能。

那么在这种情况之下，当项目变得很大之后，文件与文件之间的位置就隔得很远。例如 `pages/Home` 与 `apis/home.ts` 他们虽然属于同一页面，但是在代码结构上却相隔得非常远。

当项目页面越多，我们要找到对应页面的组成部分，就越困难。在我们专注「摸鱼」的情况下，甚至会找错页面。

因此对于前端开发来说，这种分层的代码组织效率非常低下。

在组件化思维的指导下，我们应该采用新的组织方式。组件化的思维**强调整体，强调向内聚合**，也就是说，只要是一个组件的组件部分，我们应该尽量把他们放在一起。

例如，我们有一个 Home 页面，那么就应该这样去组织代码

```bash
+ Home
  - index.tsx
  - index.css
  - api.ts
  - model.ts
```

当然，如果页面比较复杂，可能还有更多的组成部分

```bash
+ Home
  + components  // 子组件
  + images      // 图片资源
  - index.tsx
  - api.ts
  - model.ts
  - interface.d.ts
  - config.ts
  - entry.ts  // 存放一些默认值、常量、隐射关系等
  - data.cvs  // 某种别的数据格式
  ...
```

在代码结构组织上，我们也把一个组件当成一个整体，只要是属于该组件的模块，基本上都放在一个文件夹里，对外来说，Home 文件夹，就代表了 Home 组件的全部。

这就是组件化思维指导下的代码组织方式：**对内高内聚、对外低耦合**。

无论是做项目迁移，还是类似的页面复制功能，这都是最简单最高效的方式。

因此代码文件结构最终可能如下

```bash
+ src
  + components // 项目公共组件
  + pages // 所有的页面，将页面当成整体来看待
  + hooks // hooks 类工具方法
  + utils // 普通工具方法
  + api.ts // 少量的共有请求
  + router.ts // 处理路由配置
```

### 三、总结

组件化是一个初级的概念，与此同时，他又是一个很厉害的架构思维。因此，不管是初学者，还是资深架构师都应该对组件化有一个准确深刻的认知，而不是把它当成一个普通的 React 创建组件理解了就完事。